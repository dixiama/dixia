<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>DixiLand - Juegos</title>
  <style>
  body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(180deg, #eafaf1, #ffffff);
  margin: 0;
  padding: 20px;
  color: #0f172a;
}
h1 { 
  text-align: center; 
  color: #0a0e71; 
}

/* Estad√≠sticas */
.stats {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.stat {
  background: white;
  border-radius: 14px;
  padding: 15px 25px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  text-align: center;
  flex: 1 1 120px;
  min-width: 100px;
}
.stat strong { 
  font-size: 20px; 
  display: block; 
  margin-top: 5px; 
}

/* Unidades */
.unit {
  max-width: 600px;
  margin: 20px auto;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  padding: 20px;
}
.unit h2 { 
  margin-top: 0; 
  color: #2a2258; 
}

/* Lecciones */
.lesson {
  cursor: pointer;
  padding: 15px;
  margin: 10px 0;
  border-radius: 12px;
  background: #f7fffb;
  border: 1px solid #d7f2e5;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
  transition: 0.2s;
}
.lesson:hover { background: #e9fff3; }
.lesson.completed { 
  background: linear-gradient(90deg, #1d3689, #0d0d58); 
  color: white; 
  border: none; 
}
.lesson.locked { 
  opacity: 0.5; 
  cursor: not-allowed; 
}
.lesson .icon { font-size: 22px; }

/* Modal general */
#modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center; 
  align-items: center;
  z-index: 1000;
  padding: 10px;
}
#modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  width: 100%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
  animation: fadeIn 0.3s ease;
}
#modalContent h3 { 
  margin-top: 0; 
  color: #1a1253; 
}

/* Inputs y botones */
input {
  margin-top: 10px;
  padding: 10px;
  width: 100%;
  max-width: 280px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
button {
  margin-top: 15px;
  padding: 10px 15px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: #1c0d66;
  color: white;
  font-weight: bold;
}
button:hover { background: #261178; }

/* Opciones */
.opciones {
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
.opciones img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  cursor: pointer;
  border-radius: 10px;
  border: 2px solid transparent;
  transition: 0.15s;
}
.opciones img:hover { 
  border-color: #1c0d66; 
  transform: translateY(-3px); 
}
#feedback { 
  margin-top: 10px; 
  font-weight: bold; 
}

/* Animaci√≥n */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

@media (max-width: 600px) {
  #modal {
    padding: 15px;
    background: rgba(0,0,0,0.6); /* recupera fondo oscuro */
  }
  #modalContent {
    width: 100%;
    max-width: none;
    height: auto; /* solo ocupa lo necesario */
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    overflow-y: auto;
  }
}

</style>

</head>
<body>
  <h1>üìö DixiLand</h1>

  <div class="stats">
    <div class="stat"><div>üî• Nivel</div><strong id="nivel">1</strong></div>
    <div class="stat"><div>üíé Gems</div><strong id="gems">0</strong></div>
    <div class="stat"><div>üìñ Progreso</div><strong><span id="completadas">0</span> / 12</strong></div>
  </div>

  <!-- Unidad Matem√°ticas -->
  <div class="unit">
    <h2>Unidad 1: Matem√°ticas</h2>
    <div class="lesson" data-juego="sumaResta"><div class="icon">‚ûï</div> Suma y Resta</div>
    <div class="lesson locked" data-juego="multiplicacion"><div class="icon">‚úñÔ∏è</div> Multiplicaci√≥n</div>
    <div class="lesson locked" data-juego="division"><div class="icon">‚ûó</div> Divisi√≥n</div>
  </div>

  <!-- Unidad Dislexia -->
  <div class="unit">
    <h2>Unidad 2: Dislexia</h2>
    <div class="lesson locked" data-juego="completaPalabra"><div class="icon">üî§</div> Completa la palabra</div>
    <div class="lesson locked" data-juego="ordenaSilabas"><div class="icon">‚úçÔ∏è</div> Ordena las s√≠labas</div>
    <div class="lesson locked" data-juego="fraseSentido"><div class="icon">üëÄ</div> ¬øLa frase tiene sentido?</div>
  </div>

  <!-- Unidad Discalculia -->
  <div class="unit">
    <h2>Unidad 3: Discalculia</h2>
    <div class="lesson locked" data-juego="contarObjetos"><div class="icon">üî¢</div> Contar objetos</div>
    <div class="lesson locked" data-juego="compararNumeros"><div class="icon">‚öñÔ∏è</div> Comparar n√∫meros</div>
    <div class="lesson locked" data-juego="seriesNumericas"><div class="icon">üìà</div> Series num√©ricas</div>
  </div>

  <!-- Unidad 4: Dislexia 2 -->
<div class="unit">
  <h2>Unidad 4: Dislexia 2</h2>
  <div class="lesson locked" data-juego="memoriaPalabras"><div class="icon">üß©</div> Memoria con palabras</div>
  <div class="lesson locked" data-juego="ordenaSilabasMed"><div class="icon">üß†</div> Ordena las s√≠labas</div>
  <div class="lesson locked" data-juego="completaFrase"><div class="icon">üîç</div> Completa la frase</div>
</div>


  <!-- Modal general -->
  <div id="modal">
    <div id="modalContent"></div>
  </div>

<script>
let completadas = 0;
let gems = 0;

const unidades = {
  matematica: {
    lecciones: [
      { nombre: "sumaResta", icon: "‚ûï", tipo: "texto", subNiveles: [
          { pregunta: "7 - 2", respuesta: "5" },
          { pregunta: "10 - 4", respuesta: "6" },
          { pregunta: "15 - 9", respuesta: "6" }
        ]
      },
      { nombre: "multiplicacion", icon: "‚úñÔ∏è", tipo: "texto", subNiveles: [
          { pregunta: "3 √ó 4", respuesta: "12" },
          { pregunta: "6 √ó 7", respuesta: "42" },
          { pregunta: "8 √ó 9", respuesta: "72" }
        ]
      },
      { nombre: "division", icon: "‚ûó", tipo: "texto", subNiveles: [
          { pregunta: "10 √∑ 2", respuesta: "5" },
          { pregunta: "42 √∑ 7", respuesta: "6" },
          { pregunta: "81 √∑ 9", respuesta: "9" }
        ]
      }
    ]
  },
  dislexia: {
    lecciones: [
      { nombre: "completaPalabra", icon: "‚úèÔ∏è", tipo: "texto", subNiveles: [
          { pregunta: "El g__to est√° en la casa", respuesta: "gato" },
          { pregunta: "La c___ra es blanca", respuesta: "cabra" },
          { pregunta: "El so__ es amarillo", respuesta: "sol" }
        ]
      },
      { nombre: "ordenaSilabas", icon: "üî§", tipo: "texto", subNiveles: [
          { pregunta: "Ordena: to-ga ‚Üí ? ", respuesta: "gato" },
          { pregunta: "Ordena: ra-cab ‚Üí ? ", respuesta: "cabra" },
          { pregunta: "Ordena: lo-s ‚Üí ? ", respuesta: "sol" }
        ]
      },
      { nombre: "fraseSentido", icon: "üí¨", tipo: "texto", subNiveles: [
          { pregunta: "La luna es de queso", respuesta: "no" },
          { pregunta: "El perro ladra", respuesta: "si" },
          { pregunta: "El cielo es verde", respuesta: "no" }
        ]
      }
    ]
  },
  discalculia: {
    lecciones: [
      { nombre: "contarObjetos", icon: "üî¢", tipo: "texto", subNiveles: [
          { pregunta: "üçéüçéüçé ¬øCu√°ntas manzanas hay?", respuesta: "3" },
          { pregunta: "üê∂üê∂ ¬øCu√°ntos perros hay?", respuesta: "2" },
          { pregunta: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ¬øCu√°ntas estrellas hay?", respuesta: "5" }
        ]
      },
      { nombre: "compararNumeros", icon: "‚öñÔ∏è", tipo: "opcion", subNiveles: [
          { pregunta: "¬øCu√°l es mayor? 5 o 8", opciones: ["5", "8"], respuesta: "8" },
          { pregunta: "¬øCu√°l es menor? 12 o 7", opciones: ["12", "7"], respuesta: "7" },
          { pregunta: "¬øCu√°l es mayor? 15 o 14", opciones: ["15", "14"], respuesta: "15" }
        ]
      },
      { nombre: "seriesNumericas", icon: "üìà", tipo: "texto", subNiveles: [
          { pregunta: "2, 4, __, 8", respuesta: "6" },
          { pregunta: "5, 10, __, 20", respuesta: "15" },
          { pregunta: "1, 3, __, 7", respuesta: "5" }
        ]
      }
    ]
  },

  dislexia2 : {
  lecciones: [
    {
      nombre: "memoriaPalabras",
      icon: "üß©",
      tipo: "memoria",
      subNiveles: [
        { palabras: ["gato", "perro", "sol", "luna"] } // ejemplo, se duplican y se barajan en el juego
      ]
    },
    {
      nombre: "ordenaSilabasMed",
      icon: "üî§",
      tipo: "ordenaSilabasMed",
      subNiveles: [
        { silabas: ["me","ra","lo","ca"], respuesta: "caramelo" },
        { silabas: ["lle","ba","na"], respuesta: "ballena" },
        { silabas: ["pa","ma","lo"], respuesta: "paloma" }
      ]
    },
    {
  nombre: "completaFrase",
  icon: "üìù",
  tipo: "opcionFrase",
  subNiveles: [
    { frase: "El ___ ladra fuerte", opciones: ["gato","perro","luna"], respuesta: "perro" },
    { frase: "El ___ est√° en el √°rbol", opciones: ["vaca","luna","gato"], respuesta: "gato" },
    { frase: "El ___ brilla en el cielo", opciones: ["sol","perro","silla"], respuesta: "sol" }
  ]
}
  ]
},

};

let progreso = {
  matematica: { leccion: 0, subNivel: 0 },
  dislexia: { leccion: 0, subNivel: 0 },
  discalculia: { leccion: 0, subNivel: 0 },
  dislexia2: { leccion: 0, subNivel: 0 }
};

function normalizar(texto) {
  if (typeof texto !== 'string') return String(texto).trim().toLowerCase();
  return texto.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}

document.querySelectorAll('.lesson').forEach(lesson => {
  lesson.addEventListener('click', () => {
    if (lesson.classList.contains("locked")) return;
    const juego = lesson.dataset.juego;
    let unidad = null;
    for (const key in unidades) {
      if (unidades[key].lecciones.some(l => l.nombre === juego)) {
        unidad = key; break;
      }
    }
    if (unidad) abrirLeccion(unidad, lesson);
  });
});

function abrirLeccion(unidad, lessonEl) {
  const prog = progreso[unidad];
  const leccionActual = unidades[unidad].lecciones[prog.leccion];
  const nivelActual = leccionActual.subNiveles[prog.subNivel];
  mostrarJuegoPorTipo(leccionActual.tipo || 'texto', nivelActual, unidad, lessonEl);
}

function avanzarSubNivel(unidad, lessonEl) {
  let prog = progreso[unidad];
  const leccionActual = unidades[unidad].lecciones[prog.leccion];

  if (prog.subNivel + 1 < leccionActual.subNiveles.length) {
    // siguiente subnivel dentro de la misma lecci√≥n
    prog.subNivel++;
    abrirLeccion(unidad, lessonEl); // mostrar siguiente subnivel autom√°ticamente
  } else {
    // No quedan m√°s subniveles => se completa la lecci√≥n y desbloquea la siguiente
    prog.leccion++;
    prog.subNivel = 0;

    const siguienteLeccion = unidades[unidad].lecciones[prog.leccion];
    if (siguienteLeccion) {
      const el = document.querySelector(`[data-juego="${siguienteLeccion.nombre}"]`);
      if (el) el.classList.remove("locked");
    } else {
      // Si no hay m√°s lecciones en esta unidad -> desbloquear la primera de la siguiente unidad
      const unidadesKeys = Object.keys(unidades);
      const indiceUnidadActual = unidadesKeys.indexOf(unidad);
      const siguienteUnidad = unidadesKeys[indiceUnidadActual + 1];

      if (siguienteUnidad) {
        const primeraLeccion = unidades[siguienteUnidad].lecciones[0];
        if (primeraLeccion) {
          const el = document.querySelector(`[data-juego="${primeraLeccion.nombre}"]`);
          if (el) el.classList.remove("locked"); // <--- esto desbloquea la unidad 4
        }
      }
    }

    cerrarModal();
  }

}


// ===== Manejo de clicks en lecciones =====
document.querySelectorAll('.lesson').forEach(lesson => {
  lesson.addEventListener('click', () => {
    if (lesson.classList.contains("locked")) return;

    const juego = lesson.dataset.juego;

    // Buscar unidad correcta por nombre de lecci√≥n
    let unidad = Object.keys(unidades).find(key => 
      unidades[key].lecciones.some(l => l.nombre === juego)
    );

    if (unidad) abrirLeccion(unidad, lesson);
  });
});

function mostrarJuegoPorTipo(tipo, data, unidad, lessonEl) {
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalContent');
  content.innerHTML = '';
  modal.style.display = 'flex';

  if (tipo === 'texto') {
    content.innerHTML = `<h3>${data.pregunta}</h3>
      <input type="text" id="respuesta" placeholder="Tu respuesta">
      <br>
      <button id="btnResponder">Responder</button>
      <div id="feedback"></div>`;
    document.getElementById('btnResponder').onclick = function () {
      const resp = document.getElementById('respuesta').value;
      const fb = document.getElementById('feedback');
      if (normalizar(resp) === normalizar(data.respuesta)) {
        fb.style.color='green'; fb.innerText='‚úÖ ¬°Correcto!';
        marcarCompletada(lessonEl);
        setTimeout(() => avanzarSubNivel(unidad, lessonEl), 700);
      } else { fb.style.color='red'; fb.innerText='‚ùå Intenta de nuevo'; }
    };
  }
  else if (tipo === 'imagen') {
    let html = `<h3>${data.pregunta}</h3><div class="opciones">`;
    data.opciones.forEach((op, idx) => {
      html += `<img src="${op.img}" data-correcto="${op.correcto ? 'true':'false'}" alt="op${idx}">`;
    });
    html += `</div><div id="feedback"></div>`;
    content.innerHTML = html;
    content.querySelectorAll('.opciones img').forEach(img => {
      img.addEventListener('click', () => {
        const esCorrecto = img.dataset.correcto === 'true';
        const fb = document.getElementById('feedback');
        if (esCorrecto) { fb.style.color='green'; fb.innerText='‚úÖ ¬°Correcto!'; marcarCompletada(lessonEl); setTimeout(()=>avanzarSubNivel(unidad, lessonEl),700); }
        else { fb.style.color='red'; fb.innerText='‚ùå Prueba otra'; }
      });
    });
  } 
  else if (tipo === 'opcion') {
    let html = `<h3>${data.pregunta}</h3><div class="opciones">`;
    data.opciones.forEach(op => { html += `<button class="btnOpcion">${op}</button>`; });
    html += `</div><div id="feedback"></div>`;
    content.innerHTML = html;
    content.querySelectorAll('.btnOpcion').forEach(btn => {
      btn.addEventListener('click', () => {
        const esCorrecto = normalizar(btn.textContent) === normalizar(data.respuesta);
        const fb = document.getElementById('feedback');
        if (esCorrecto) { fb.style.color='green'; fb.innerText='‚úÖ ¬°Correcto!'; marcarCompletada(lessonEl); setTimeout(()=>avanzarSubNivel(unidad, lessonEl),700); }
        else { fb.style.color='red'; fb.innerText='‚ùå Intenta otra opci√≥n'; }
      });
    });
  }
  else if (tipo === 'memoria') {
    let palabras = [...data.palabras, ...data.palabras];
    palabras.sort(() => Math.random() - 0.5);
    content.innerHTML = `<h3>Empareja las palabras iguales</h3><div class="opciones" id="cartas"></div><div id="feedback"></div>`;
    const contenedor = document.getElementById('cartas');
    let seleccion = [];
    let aciertos = 0;
    palabras.forEach((palabra, idx) => {
      const carta = document.createElement('div');
      carta.style.cssText = 'width:80px;height:80px;margin:5px;background:#e0e0e0;display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;border-radius:10px;';
      carta.dataset.valor = palabra;
      carta.innerText = "?";
      contenedor.appendChild(carta);
      carta.addEventListener('click', () => {
        if (carta.innerText !== "?") return;
        carta.innerText = palabra;
        seleccion.push(carta);
        if (seleccion.length === 2) {
          setTimeout(() => {
            if (seleccion[0].dataset.valor === seleccion[1].dataset.valor) {
              aciertos++;
              seleccion.forEach(c => c.style.background = 'lightgreen');
              if (aciertos === data.palabras.length) {
                marcarCompletada(lessonEl);
                setTimeout(() => avanzarSubNivel(unidad, lessonEl), 700);
              }
            } else { seleccion.forEach(c => c.innerText = "?"); }
            seleccion = [];
          }, 500);
        }
      });
    });
  }
  
  else if (tipo === 'ordenaSilabasMed') {
    const silabas = [...data.silabas]; // ej: ["ME","LO","CO","RA"]
    const palabraCorrecta = data.respuesta; // ej: "CARAMEL"
    const silabasDesordenadas = silabas.sort(() => Math.random() - 0.5);
    let seleccion = [];

    content.innerHTML = `<h3>Ordena las s√≠labas para formar la palabra:</h3>
      <div id="silabas" style="display:flex; gap:10px; flex-wrap:wrap;"></div>
      <button id="btnVerificar">Verificar</button>
      <div id="feedback"></div>`;

    const silabasDiv = document.getElementById('silabas');
    silabasDesordenadas.forEach(s => {
      const btn = document.createElement('button');
      btn.textContent = s;
      btn.style.padding = '8px 12px';
      btn.style.margin = '5px';
      btn.style.borderRadius = '8px';
      btn.style.border = '1px solid #ccc';
      btn.style.cursor = 'pointer';
      btn.onclick = () => {
        if(seleccion.length < silabas.length) {
          seleccion.push(s);
          actualizarSeleccion();
        }
      };
      silabasDiv.appendChild(btn);
    });

    function actualizarSeleccion() {
      const fb = document.getElementById('feedback');
      fb.innerText = "Tu selecci√≥n: " + seleccion.join("-");
    }

    document.getElementById('btnVerificar').onclick = () => {
      const fb = document.getElementById('feedback');
      if (seleccion.join("") === palabraCorrecta) {
        fb.style.color='green'; fb.innerText='‚úÖ ¬°Correcto!';
        marcarCompletada(lessonEl);
        setTimeout(() => avanzarSubNivel(unidad, lessonEl), 700);
      } else {
        fb.style.color='red'; fb.innerText='‚ùå Intenta de nuevo';
        seleccion = [];
      }
    };
  }

  else if (tipo === 'opcionFrase') {
  content.innerHTML = `<h3>${data.frase}</h3><div class="opciones"></div><div id="feedback"></div>`;
  const contenedor = content.querySelector('.opciones');
  data.opciones.forEach(op => {
    const btn = document.createElement('button');
    btn.textContent = op;
    btn.style.margin = "5px";
    btn.style.padding = "8px 12px";
    btn.style.borderRadius = "8px";
    btn.style.border = "1px solid #ccc";
    btn.style.cursor = "pointer";
    btn.onclick = () => {
      const fb = document.getElementById('feedback');
      if(normalizar(op) === normalizar(data.respuesta)) {
        fb.style.color = 'green';
        fb.innerText = "‚úÖ ¬°Correcto!";
        marcarCompletada(lessonEl);
        setTimeout(() => avanzarSubNivel(unidad, lessonEl), 700);
      } else {
        fb.style.color = 'red';
        fb.innerText = "‚ùå Intenta otra opci√≥n";
      }
    };
    contenedor.appendChild(btn);
  });
}


  else {
    content.innerHTML = `<h3>Tipo de juego no soportado</h3><div id="feedback"></div>`;
  }
}


function marcarCompletada(lessonEl) {
  if (!lessonEl.classList.contains("completed")) {
    completadas += 1; gems += 50; lessonEl.classList.add("completed"); actualizarProgreso();
  }
}

function actualizarProgreso() {
  document.getElementById("completadas").textContent = completadas;
  document.getElementById("gems").textContent = gems;
}

function cerrarModal() {
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalContent');
  modal.style.display = 'none';
  content.innerHTML = '';
}

document.getElementById('modal').addEventListener('click', (e) => { if(e.target.id==='modal') cerrarModal(); });
</script>

</body>
</html>
